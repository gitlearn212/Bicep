# Login to Azure
$tenantId = "<tenantId>"
$clientId = "<clientId>"
$clientSecret = "<clientSecret>"
$securePassword = ConvertTo-SecureString $clientSecret -AsPlainText -Force
$credential = New-Object System.Management.Automation.PSCredential($clientId, $securePassword)
Connect-AzAccount -ServicePrincipal -Credential $credential -Tenant $tenantId

# Set the context to the specific subscription
$subscriptionId = "<subscriptionId>"
Set-AzContext -SubscriptionId $subscriptionId

# Deploy the Bicep file
New-AzResourceGroupDeployment -ResourceGroupName "rg1" -TemplateFile "./changeDiskSku.bicep" -WhatIf


param vmName string = 'a1'
param location string = 'westus' // replace with your actual location

resource virtualMachine 'Microsoft.Compute/virtualMachines@2021-04-01' existing = {
  name: vmName
  location: location
}

resource virtualMachine_disk 'Microsoft.Compute/virtualMachines/disks@2021-04-01' = {
  parent: virtualMachine
  name: '${virtualMachine.name}_disk'
  properties: {
    storageAccountType: 'Standard_B2ms'
  }
}
